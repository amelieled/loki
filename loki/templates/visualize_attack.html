{% extends 'layout.html' %}


{% block content %}
<div class="row">
    <form class="" action="" method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <main role="main" class="container">
            <div class="row">
                <div class="col md-4">
                    <h1>List of attacks</h1>
                        {% if form.attacks.errors %}
                            {{ form.attacks.label(class="form-control form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.attacks.errors %}
                                    <span>
                                        {{ error }}
                                    </span>
                                {% endfor %}
                            </div>
                        {% endif %}
                        {% for subfield in form.attacks %}
                            <tr>
                                <td>{{ subfield }}</td>
                                <td>{{ subfield.label }}</td>
                            </tr>
                            <br>
                        {% endfor %}
                        <div class="form-group">
                            {{ form.submit(class="btn btn-dark") }}
                        </div>
                </div>
                <div class="col md-4">
                    <div class="image-preview" id="imagePreview">
                        {% if form.image.data %}
                        {% set image_filename %}/tmp/{{ image_file }}{% endset %}
                        <img src="{{ url_for('static', filename=image_filename) }}" class="image-preview__image2">
                        {% else %}
                        <img src="" class="image-preview__image">
                        <span class="image-preview__default-text">
                            <label class="image_button">
                                {{ form.image(type="file") }}
                            </label>
                        </span>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        {% if form.image.errors %}
                        {% for error in form.image.errors %}
                            <span class="text-danger"> {{ error }} </span></br>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
                <div class="col md-4">
                    <div class="image-preview" id="nextimagePreview">
                        {% if form.image.data %}
                        {% set result_filename %}/tmp/{{ image_file }}{% endset %}
                        <img src="{{ url_for('static', filename=result_filename) }}" class="image-preview__image2">
                        {% else %}
                        <img src="" alt="Next Image Preview" class="image-preview__image">
                        <span class="image-preview__default-text">NextImage Preview</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </main>
    </form>

</div>
<script>
    const inpFile = document.getElementById("image");
    const previewContainer = document.getElementById("imagePreview");
    const previewImage = previewContainer.querySelector(".image-preview__image");
    const previewDefaultText = previewContainer.querySelector(".image-preview__default-text");

    inpFile.addEventListener("change", function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();

            previewDefaultText.style.display = "none";
            previewImage.style.display = "block";

            reader.addEventListener("load", function() {
                previewImage.setAttribute('src', this.result);
            });

            reader.readAsDataURL(file);
        } else {
            previewDefaultText.style.display = null;
            previewImage.style.display = "block";
            previewImage.setAttribute('src', this.result);
        }
    });
</script>

{% endblock content %}
